shadow$provide.module$node_modules$web3_providers_ipc$src$index=function(global,require,module,exports){var _=require("module$node_modules$underscore$underscore"),errors=require("module$node_modules$web3_core_helpers$src$index").errors,oboe=require("module$node_modules$oboe$dist$oboe_browser");global=function(path,net){var _this=this;this.responseCallbacks={};this.notificationCallbacks=[];this.path=path;this.connected=!1;this.connection=net.connect({path:this.path});this.addDefaultEvents();var callback$jscomp$0=
function(result){var id=null;_.isArray(result)?result.forEach(function(load){_this.responseCallbacks[load.id]&&(id=load.id)}):id=result.id;id||-1===result.method.indexOf("_subscription")?_this.responseCallbacks[id]&&(_this.responseCallbacks[id](null,result),delete _this.responseCallbacks[id]):_this.notificationCallbacks.forEach(function(callback){_.isFunction(callback)&&callback(result)})};if("Socket"===net.constructor.name)oboe(this.connection).done(callback$jscomp$0);else this.connection.on("data",
function(data){_this._parseResponse(data.toString()).forEach(callback$jscomp$0)})};global.prototype.addDefaultEvents=function(){var _this=this;this.connection.on("connect",function(){_this.connected=!0});this.connection.on("close",function(){_this.connected=!1});this.connection.on("error",function(){_this._timeout()});this.connection.on("end",function(){_this._timeout()});this.connection.on("timeout",function(){_this._timeout()})};global.prototype._parseResponse=function(data$jscomp$0){var _this=
this,returnValues=[];data$jscomp$0.replace(/\}[\n\r]?\{/g,"}|--|{").replace(/\}\][\n\r]?\[\{/g,"}]|--|[{").replace(/\}[\n\r]?\[\{/g,"}|--|[{").replace(/\}\][\n\r]?\{/g,"}]|--|{").split("|--|").forEach(function(data){_this.lastChunk&&(data=_this.lastChunk+data);var result=null;try{result=JSON.parse(data)}catch(e){_this.lastChunk=data;clearTimeout(_this.lastChunkTimeout);_this.lastChunkTimeout=setTimeout(function(){_this._timeout();throw errors.InvalidResponse(data);},15E3);return}clearTimeout(_this.lastChunkTimeout);
_this.lastChunk=null;result&&returnValues.push(result)});return returnValues};global.prototype._addResponseCallback=function(payload,callback){var id=payload.id||payload[0].id;payload=payload.method||payload[0].method;this.responseCallbacks[id]=callback;this.responseCallbacks[id].method=payload};global.prototype._timeout=function(){for(var key in this.responseCallbacks)this.responseCallbacks.hasOwnProperty(key)&&(this.responseCallbacks[key](errors.InvalidConnection("on IPC")),delete this.responseCallbacks[key])};
global.prototype.reconnect=function(){this.connection.connect({path:this.path})};global.prototype.send=function(payload,callback){this.connection.writable||this.connection.connect({path:this.path});this.connection.write(JSON.stringify(payload));this._addResponseCallback(payload,callback)};global.prototype.on=function(type,callback){if("function"!==typeof callback)throw Error("The second parameter callback must be a function.");switch(type){case "data":this.notificationCallbacks.push(callback);break;
default:this.connection.on(type,callback)}};global.prototype.once=function(type,callback){if("function"!==typeof callback)throw Error("The second parameter callback must be a function.");this.connection.once(type,callback)};global.prototype.removeListener=function(type,callback){var _this=this;switch(type){case "data":this.notificationCallbacks.forEach(function(cb,index){cb===callback&&_this.notificationCallbacks.splice(index,1)});break;default:this.connection.removeListener(type,callback)}};global.prototype.removeAllListeners=
function(type){switch(type){case "data":this.notificationCallbacks=[];break;default:this.connection.removeAllListeners(type)}};global.prototype.reset=function(){this._timeout();this.notificationCallbacks=[];this.connection.removeAllListeners("error");this.connection.removeAllListeners("end");this.connection.removeAllListeners("timeout");this.addDefaultEvents()};global.prototype.supportsSubscriptions=function(){return!0};module.exports=global}
//# sourceMappingURL=module$node_modules$web3_providers_ipc$src$index.js.map
