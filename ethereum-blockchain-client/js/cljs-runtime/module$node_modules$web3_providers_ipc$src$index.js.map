{
"version":3,
"file":"module$node_modules$web3_providers_ipc$src$index.js",
"lineCount":8,
"mappings":"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",
"sources":["node_modules/web3-providers-ipc/src/index.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$web3_providers_ipc$src$index\"] = function(global,require,module,exports) {\n/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n/** @file index.js\n * @authors:\n *   Fabian Vogelsteller <fabian@ethereum.org>\n * @date 2017\n */\n\n\"use strict\";\n\nvar _ = require('underscore');\nvar errors = require('web3-core-helpers').errors;\nvar oboe = require('oboe');\n\n\nvar IpcProvider = function IpcProvider(path, net) {\n    var _this = this;\n    this.responseCallbacks = {};\n    this.notificationCallbacks = [];\n    this.path = path;\n    this.connected = false;\n\n    this.connection = net.connect({path: this.path});\n\n    this.addDefaultEvents();\n\n    // LISTEN FOR CONNECTION RESPONSES\n    var callback = function(result) {\n        /*jshint maxcomplexity: 6 */\n\n        var id = null;\n\n        // get the id which matches the returned id\n        if(_.isArray(result)) {\n            result.forEach(function(load){\n                if(_this.responseCallbacks[load.id])\n                    id = load.id;\n            });\n        } else {\n            id = result.id;\n        }\n\n        // notification\n        if(!id && result.method.indexOf('_subscription') !== -1) {\n            _this.notificationCallbacks.forEach(function(callback){\n                if(_.isFunction(callback))\n                    callback(result);\n            });\n\n            // fire the callback\n        } else if(_this.responseCallbacks[id]) {\n            _this.responseCallbacks[id](null, result);\n            delete _this.responseCallbacks[id];\n        }\n    };\n\n    // use oboe.js for Sockets\n    if (net.constructor.name === 'Socket') {\n        oboe(this.connection)\n        .done(callback);\n    } else {\n        this.connection.on('data', function(data){\n            _this._parseResponse(data.toString()).forEach(callback);\n        });\n    }\n};\n\n/**\nWill add the error and end event to timeout existing calls\n\n@method addDefaultEvents\n*/\nIpcProvider.prototype.addDefaultEvents = function(){\n    var _this = this;\n\n    this.connection.on('connect', function(){\n        _this.connected = true;\n    });\n\n    this.connection.on('close', function(){\n        _this.connected = false;\n    });\n\n    this.connection.on('error', function(){\n        _this._timeout();\n    });\n\n    this.connection.on('end', function(){\n        _this._timeout();\n    });\n\n    this.connection.on('timeout', function(){\n        _this._timeout();\n    });\n};\n\n\n/**\n Will parse the response and make an array out of it.\n\n NOTE, this exists for backwards compatibility reasons.\n\n @method _parseResponse\n @param {String} data\n */\nIpcProvider.prototype._parseResponse = function(data) {\n    var _this = this,\n        returnValues = [];\n\n    // DE-CHUNKER\n    var dechunkedData = data\n        .replace(/\\}[\\n\\r]?\\{/g,'}|--|{') // }{\n        .replace(/\\}\\][\\n\\r]?\\[\\{/g,'}]|--|[{') // }][{\n        .replace(/\\}[\\n\\r]?\\[\\{/g,'}|--|[{') // }[{\n        .replace(/\\}\\][\\n\\r]?\\{/g,'}]|--|{') // }]{\n        .split('|--|');\n\n    dechunkedData.forEach(function(data){\n\n        // prepend the last chunk\n        if(_this.lastChunk)\n            data = _this.lastChunk + data;\n\n        var result = null;\n\n        try {\n            result = JSON.parse(data);\n\n        } catch(e) {\n\n            _this.lastChunk = data;\n\n            // start timeout to cancel all requests\n            clearTimeout(_this.lastChunkTimeout);\n            _this.lastChunkTimeout = setTimeout(function(){\n                _this._timeout();\n                throw errors.InvalidResponse(data);\n            }, 1000 * 15);\n\n            return;\n        }\n\n        // cancel timeout and set chunk to null\n        clearTimeout(_this.lastChunkTimeout);\n        _this.lastChunk = null;\n\n        if(result)\n            returnValues.push(result);\n    });\n\n    return returnValues;\n};\n\n\n/**\nGet the adds a callback to the responseCallbacks object,\nwhich will be called if a response matching the response Id will arrive.\n\n@method _addResponseCallback\n*/\nIpcProvider.prototype._addResponseCallback = function(payload, callback) {\n    var id = payload.id || payload[0].id;\n    var method = payload.method || payload[0].method;\n\n    this.responseCallbacks[id] = callback;\n    this.responseCallbacks[id].method = method;\n};\n\n/**\nTimeout all requests when the end/error event is fired\n\n@method _timeout\n*/\nIpcProvider.prototype._timeout = function() {\n    for(var key in this.responseCallbacks) {\n        if(this.responseCallbacks.hasOwnProperty(key)){\n            this.responseCallbacks[key](errors.InvalidConnection('on IPC'));\n            delete this.responseCallbacks[key];\n        }\n    }\n};\n\n/**\n Try to reconnect\n\n @method reconnect\n */\nIpcProvider.prototype.reconnect = function() {\n    this.connection.connect({path: this.path});\n};\n\n\nIpcProvider.prototype.send = function (payload, callback) {\n    // try reconnect, when connection is gone\n    if(!this.connection.writable)\n        this.connection.connect({path: this.path});\n\n\n    this.connection.write(JSON.stringify(payload));\n    this._addResponseCallback(payload, callback);\n};\n\n/**\nSubscribes to provider events.provider\n\n@method on\n@param {String} type    'notification', 'connect', 'error', 'end' or 'data'\n@param {Function} callback   the callback to call\n*/\nIpcProvider.prototype.on = function (type, callback) {\n\n    if(typeof callback !== 'function')\n        throw new Error('The second parameter callback must be a function.');\n\n    switch(type){\n        case 'data':\n            this.notificationCallbacks.push(callback);\n            break;\n\n        // adds error, end, timeout, connect\n        default:\n            this.connection.on(type, callback);\n            break;\n    }\n};\n\n/**\n Subscribes to provider events.provider\n\n @method on\n @param {String} type    'connect', 'error', 'end' or 'data'\n @param {Function} callback   the callback to call\n */\nIpcProvider.prototype.once = function (type, callback) {\n\n    if(typeof callback !== 'function')\n        throw new Error('The second parameter callback must be a function.');\n\n    this.connection.once(type, callback);\n};\n\n/**\nRemoves event listener\n\n@method removeListener\n@param {String} type    'data', 'connect', 'error', 'end' or 'data'\n@param {Function} callback   the callback to call\n*/\nIpcProvider.prototype.removeListener = function (type, callback) {\n    var _this = this;\n\n    switch(type){\n        case 'data':\n            this.notificationCallbacks.forEach(function(cb, index){\n                if(cb === callback)\n                    _this.notificationCallbacks.splice(index, 1);\n            });\n            break;\n\n        default:\n            this.connection.removeListener(type, callback);\n            break;\n    }\n};\n\n/**\nRemoves all event listeners\n\n@method removeAllListeners\n@param {String} type    'data', 'connect', 'error', 'end' or 'data'\n*/\nIpcProvider.prototype.removeAllListeners = function (type) {\n    switch(type){\n        case 'data':\n            this.notificationCallbacks = [];\n            break;\n\n        default:\n            this.connection.removeAllListeners(type);\n            break;\n    }\n};\n\n/**\nResets the providers, clears all callbacks\n\n@method reset\n*/\nIpcProvider.prototype.reset = function () {\n    this._timeout();\n    this.notificationCallbacks = [];\n\n    this.connection.removeAllListeners('error');\n    this.connection.removeAllListeners('end');\n    this.connection.removeAllListeners('timeout');\n\n    this.addDefaultEvents();\n};\n\n/**\n * Returns the desired boolean.\n *\n * @method supportsSubscriptions\n * @returns {boolean}\n */\nIpcProvider.prototype.supportsSubscriptions = function () {\n    return true;\n};\n\nmodule.exports = IpcProvider;\n\n\n};"],
"names":["shadow$provide","global","require","module","exports","_","errors","oboe","IpcProvider","path","net","_this","responseCallbacks","notificationCallbacks","connected","connection","connect","addDefaultEvents","callback","result","id","isArray","forEach","load","method","indexOf","isFunction","constructor","name","done","on","data","_parseResponse","toString","prototype","IpcProvider.prototype.addDefaultEvents","_timeout","IpcProvider.prototype._parseResponse","returnValues","replace","split","dechunkedData","lastChunk","JSON","parse","e","clearTimeout","lastChunkTimeout","setTimeout","InvalidResponse","push","_addResponseCallback","IpcProvider.prototype._addResponseCallback","payload","IpcProvider.prototype._timeout","key","hasOwnProperty","InvalidConnection","reconnect","IpcProvider.prototype.reconnect","send","IpcProvider.prototype.send","writable","write","stringify","IpcProvider.prototype.on","type","Error","once","IpcProvider.prototype.once","removeListener","IpcProvider.prototype.removeListener","cb","index","splice","removeAllListeners","IpcProvider.prototype.removeAllListeners","reset","IpcProvider.prototype.reset","supportsSubscriptions","IpcProvider.prototype.supportsSubscriptions"]
}
