shadow$provide.module$node_modules$web3_providers_ws$src$index=function(global,require,module,exports){global=require("module$node_modules$process$browser");var Buffer=require("module$node_modules$buffer$index").Buffer;"use strict";var _=require("module$node_modules$underscore$underscore"),errors=require("module$node_modules$web3_core_helpers$src$index").errors,Ws=require("module$node_modules$$web3_js$websocket$lib$browser").w3cwebsocket,_btoa=null,parseURL=null;if("[object process]"===Object.prototype.toString.call("undefined"!==
typeof global?global:0))if(_btoa=function(str){return Buffer.from(str).toString("base64")},global=require("module$node_modules$url$url"),global.URL){var newURL=global.URL;parseURL=function(url){return new newURL(url)}}else parseURL=require("module$node_modules$url$url").parse;else _btoa=btoa,parseURL=function(url){return new URL(url)};require=function(url,options){if(!Ws)throw Error("websocket is not available");var _this=this;this.responseCallbacks={};this.notificationCallbacks=[];options=options||
{};this._customTimeout=options.timeout;var parsedURL=parseURL(url),headers=options.headers||{},protocol=options.protocol||void 0;parsedURL.username&&parsedURL.password&&(headers.authorization="Basic "+_btoa(parsedURL.username+":"+parsedURL.password));var clientConfig=options.clientConfig||void 0;options=options.requestOptions||void 0;parsedURL.auth&&(headers.authorization="Basic "+_btoa(parsedURL.auth));this.connection=new Ws(url,protocol,void 0,headers,options,clientConfig);this.addDefaultEvents();
this.connection.onmessage=function(e){_this._parseResponse("string"===typeof e.data?e.data:"").forEach(function(result){var id=null;_.isArray(result)?result.forEach(function(load){_this.responseCallbacks[load.id]&&(id=load.id)}):id=result.id;!id&&result&&result.method&&-1!==result.method.indexOf("_subscription")?_this.notificationCallbacks.forEach(function(callback){_.isFunction(callback)&&callback(result)}):_this.responseCallbacks[id]&&(_this.responseCallbacks[id](null,result),delete _this.responseCallbacks[id])})};
Object.defineProperty(this,"connected",{get:function(){return this.connection&&this.connection.readyState===this.connection.OPEN},enumerable:!0})};require.prototype.addDefaultEvents=function(){var _this=this;this.connection.onerror=function(){_this._timeout()};this.connection.onclose=function(){_this._timeout();_this.reset()}};require.prototype._parseResponse=function(data$jscomp$0){var _this=this,returnValues=[];data$jscomp$0.replace(/\}[\n\r]?\{/g,"}|--|{").replace(/\}\][\n\r]?\[\{/g,"}]|--|[{").replace(/\}[\n\r]?\[\{/g,
"}|--|[{").replace(/\}\][\n\r]?\{/g,"}]|--|{").split("|--|").forEach(function(data){_this.lastChunk&&(data=_this.lastChunk+data);var result=null;try{result=JSON.parse(data)}catch(e){_this.lastChunk=data;clearTimeout(_this.lastChunkTimeout);_this.lastChunkTimeout=setTimeout(function(){_this._timeout();throw errors.InvalidResponse(data);},15E3);return}clearTimeout(_this.lastChunkTimeout);_this.lastChunk=null;result&&returnValues.push(result)});return returnValues};require.prototype._addResponseCallback=
function(payload,callback){var id=payload.id||payload[0].id;payload=payload.method||payload[0].method;this.responseCallbacks[id]=callback;this.responseCallbacks[id].method=payload;var _this=this;this._customTimeout&&setTimeout(function(){_this.responseCallbacks[id]&&(_this.responseCallbacks[id](errors.ConnectionTimeout(_this._customTimeout)),delete _this.responseCallbacks[id])},this._customTimeout)};require.prototype._timeout=function(){for(var key in this.responseCallbacks)this.responseCallbacks.hasOwnProperty(key)&&
(this.responseCallbacks[key](errors.InvalidConnection("on WS")),delete this.responseCallbacks[key])};require.prototype.send=function(payload,callback){var _this=this;if(this.connection.readyState===this.connection.CONNECTING)setTimeout(function(){_this.send(payload,callback)},10);else if(this.connection.readyState!==this.connection.OPEN){console.error("connection not open on send()");if("function"===typeof this.connection.onerror)this.connection.onerror(Error("connection not open"));else console.error("no error callback");
callback(Error("connection not open"))}else this.connection.send(JSON.stringify(payload)),this._addResponseCallback(payload,callback)};require.prototype.on=function(type,callback){if("function"!==typeof callback)throw Error("The second parameter callback must be a function.");switch(type){case "data":this.notificationCallbacks.push(callback);break;case "connect":this.connection.onopen=callback;break;case "end":this.connection.onclose=callback;break;case "error":this.connection.onerror=callback}};
require.prototype.removeListener=function(type,callback){var _this=this;switch(type){case "data":this.notificationCallbacks.forEach(function(cb,index){cb===callback&&_this.notificationCallbacks.splice(index,1)})}};require.prototype.removeAllListeners=function(type){switch(type){case "data":this.notificationCallbacks=[];break;case "connect":this.connection.onopen=null;break;case "end":this.connection.onclose=null;break;case "error":this.connection.onerror=null}};require.prototype.reset=function(){this._timeout();
this.notificationCallbacks=[];this.addDefaultEvents()};require.prototype.disconnect=function(){this.connection&&this.connection.close()};require.prototype.supportsSubscriptions=function(){return!0};module.exports=require}
//# sourceMappingURL=module$node_modules$web3_providers_ws$src$index.js.map
