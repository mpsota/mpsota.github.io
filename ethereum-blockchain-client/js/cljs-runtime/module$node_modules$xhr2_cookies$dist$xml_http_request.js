shadow$provide.module$node_modules$xhr2_cookies$dist$xml_http_request=function(global,require,module,exports){var process=require("module$node_modules$process$browser"),Buffer=require("module$node_modules$buffer$index").Buffer;"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=
d}extendStatics(d,b);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),__assign=this&&this.__assign||Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t};Object.defineProperty(exports,"__esModule",{value:!0});var http=require("module$node_modules$stream_http$index"),https=require("module$node_modules$https_browserify$index"),os=require("module$node_modules$os_browserify$browser"),
url$jscomp$0=require("module$node_modules$url$url"),progress_event_1=require("module$node_modules$xhr2_cookies$dist$progress_event"),errors_1=require("module$node_modules$xhr2_cookies$dist$errors");global=require("module$node_modules$xhr2_cookies$dist$xml_http_request_event_target");var xml_http_request_upload_1=require("module$node_modules$xhr2_cookies$dist$xml_http_request_upload"),Cookie=require("module$node_modules$cookiejar$cookiejar");require=function(_super){function XMLHttpRequest(options){void 0===
options&&(options={});var _this=_super.call(this)||this;_this.UNSENT=XMLHttpRequest.UNSENT;_this.OPENED=XMLHttpRequest.OPENED;_this.HEADERS_RECEIVED=XMLHttpRequest.HEADERS_RECEIVED;_this.LOADING=XMLHttpRequest.LOADING;_this.DONE=XMLHttpRequest.DONE;_this.onreadystatechange=null;_this.readyState=XMLHttpRequest.UNSENT;_this.response=null;_this.responseText="";_this.responseType="";_this.status=0;_this.statusText="";_this.timeout=0;_this.upload=new xml_http_request_upload_1.XMLHttpRequestUpload;_this.responseUrl=
"";_this.withCredentials=!1;_this._method=null;_this._url=null;_this._sync=!1;_this._headers={};_this._loweredHeaders={};_this._mimeOverride=null;_this._request=null;_this._response=null;_this._responseParts=null;_this._responseHeaders=null;_this._aborting=null;_this._error=null;_this._loadedBytes=0;_this._totalBytes=0;_this._lengthComputable=!1;_this._restrictedMethods={CONNECT:!0,TRACE:!0,TRACK:!0};_this._restrictedHeaders={"accept-charset":!0,"accept-encoding":!0,"access-control-request-headers":!0,
"access-control-request-method":!0,connection:!0,"content-length":!0,cookie:!0,cookie2:!0,date:!0,dnt:!0,expect:!0,host:!0,"keep-alive":!0,origin:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,via:!0};_this._privateHeaders={"set-cookie":!0,"set-cookie2":!0};_this._userAgent="Mozilla/5.0 ("+os.type()+" "+os.arch()+") node.js/"+process.versions.node+" v8/"+process.versions.v8;_this._anonymous=options.anon||!1;return _this}__extends(XMLHttpRequest,_super);XMLHttpRequest.prototype.open=
function(method,url,async,user,password){void 0===async&&(async=!0);method=method.toUpperCase();if(this._restrictedMethods[method])throw new XMLHttpRequest.SecurityError("HTTP method "+method+" is not allowed in XHR");url=this._parseUrl(url,user,password);this._method=method;this._url=url;this._sync=!async;this._headers={};this._loweredHeaders={};this._mimeOverride=null;this._setReadyState(XMLHttpRequest.OPENED);this._response=this._request=null;this.status=0;this.statusText="";this._responseParts=
[];this._responseHeaders=null;this._totalBytes=this._loadedBytes=0;this._lengthComputable=!1};XMLHttpRequest.prototype.setRequestHeader=function(name,value){if(this.readyState!==XMLHttpRequest.OPENED)throw new XMLHttpRequest.InvalidStateError("XHR readyState must be OPENED");var loweredName=name.toLowerCase();this._restrictedHeaders[loweredName]||/^sec-/.test(loweredName)||/^proxy-/.test(loweredName)?console.warn('Refused to set unsafe header "'+name+'"'):(value=value.toString(),null!=this._loweredHeaders[loweredName]?
(name=this._loweredHeaders[loweredName],this._headers[name]=this._headers[name]+", "+value):(this._loweredHeaders[loweredName]=name,this._headers[name]=value))};XMLHttpRequest.prototype.send=function(data){if(this.readyState!==XMLHttpRequest.OPENED)throw new XMLHttpRequest.InvalidStateError("XHR readyState must be OPENED");if(this._request)throw new XMLHttpRequest.InvalidStateError("send() already called");switch(this._url.protocol){case "file:":return this._sendFile(data);case "http:":case "https:":return this._sendHttp(data);
default:throw new XMLHttpRequest.NetworkError("Unsupported protocol "+this._url.protocol);}};XMLHttpRequest.prototype.abort=function(){null!=this._request&&(this._request.abort(),this._setError(),this._dispatchProgress("abort"),this._dispatchProgress("loadend"))};XMLHttpRequest.prototype.getResponseHeader=function(name){if(null==this._responseHeaders||null==name)return null;var loweredName=name.toLowerCase();return this._responseHeaders.hasOwnProperty(loweredName)?this._responseHeaders[name.toLowerCase()]:
null};XMLHttpRequest.prototype.getAllResponseHeaders=function(){var _this=this;return null==this._responseHeaders?"":Object.keys(this._responseHeaders).map(function(key){return key+": "+_this._responseHeaders[key]}).join("\r\n")};XMLHttpRequest.prototype.overrideMimeType=function(mimeType){if(this.readyState===XMLHttpRequest.LOADING||this.readyState===XMLHttpRequest.DONE)throw new XMLHttpRequest.InvalidStateError("overrideMimeType() not allowed in LOADING or DONE");this._mimeOverride=mimeType.toLowerCase()};
XMLHttpRequest.prototype.nodejsSet=function(options){this.nodejsHttpAgent=options.httpAgent||this.nodejsHttpAgent;this.nodejsHttpsAgent=options.httpsAgent||this.nodejsHttpsAgent;if(options.hasOwnProperty("baseUrl")){if(null!=options.baseUrl&&!url$jscomp$0.parse(options.baseUrl,!1,!0).protocol)throw new XMLHttpRequest.SyntaxError("baseUrl must be an absolute URL");this.nodejsBaseUrl=options.baseUrl}};XMLHttpRequest.nodejsSet=function(options){XMLHttpRequest.prototype.nodejsSet(options)};XMLHttpRequest.prototype._setReadyState=
function(readyState){this.readyState=readyState;this.dispatchEvent(new progress_event_1.ProgressEvent("readystatechange"))};XMLHttpRequest.prototype._sendFile=function(data){throw Error("Protocol file: not implemented");};XMLHttpRequest.prototype._sendHttp=function(data){if(this._sync)throw Error("Synchronous XHR processing not implemented");!data||"GET"!==this._method&&"HEAD"!==this._method?data=data||"":(console.warn("Discarding entity body for "+this._method+" requests"),data=null);this.upload._setData(data);
this._finalizeHeaders();this._sendHxxpRequest()};XMLHttpRequest.prototype._sendHxxpRequest=function(){var _this=this;if(this.withCredentials){var cookie=XMLHttpRequest.cookieJar.getCookies(Cookie.CookieAccessInfo(this._url.hostname,this._url.pathname,"https:"===this._url.protocol)).toValueString();this._headers.cookie=this._headers.cookie2=cookie}var _a="http:"===this._url.protocol?[http,this.nodejsHttpAgent]:[https,this.nodejsHttpsAgent];cookie=_a[0];_a=_a[1];var request=cookie.request.bind(cookie)({hostname:this._url.hostname,
port:+this._url.port,path:this._url.path,auth:this._url.auth,method:this._method,headers:this._headers,agent:_a});this._request=request;this.timeout&&request.setTimeout(this.timeout,function(){return _this._onHttpTimeout(request)});request.on("response",function(response){return _this._onHttpResponse(request,response)});request.on("error",function(error){return _this._onHttpRequestError(request,error)});this.upload._startUpload(request);this._request===request&&this._dispatchProgress("loadstart")};
XMLHttpRequest.prototype._finalizeHeaders=function(){this._headers=__assign({},this._headers,{Connection:"keep-alive",Host:this._url.host,"User-Agent":this._userAgent},this._anonymous?{Referer:"about:blank"}:{});this.upload._finalizeHeaders(this._headers,this._loweredHeaders)};XMLHttpRequest.prototype._onHttpResponse=function(request,response){var _this=this;this._request===request&&(this.withCredentials&&(response.headers["set-cookie"]||response.headers["set-cookie2"])&&XMLHttpRequest.cookieJar.setCookies(response.headers["set-cookie"]||
response.headers["set-cookie2"]),0<=[301,302,303,307,308].indexOf(response.statusCode)?(this._url=this._parseUrl(response.headers.location),this._method="GET",this._loweredHeaders["content-type"]&&(delete this._headers[this._loweredHeaders["content-type"]],delete this._loweredHeaders["content-type"]),null!=this._headers["Content-Type"]&&delete this._headers["Content-Type"],delete this._headers["Content-Length"],this.upload._reset(),this._finalizeHeaders(),this._sendHxxpRequest()):(this._response=
response,this._response.on("data",function(data){return _this._onHttpResponseData(response,data)}),this._response.on("end",function(){return _this._onHttpResponseEnd(response)}),this._response.on("close",function(){return _this._onHttpResponseClose(response)}),this.responseUrl=this._url.href.split("#")[0],this.status=response.statusCode,this.statusText=http.STATUS_CODES[this.status],this._parseResponseHeaders(response),request=this._responseHeaders["content-length"]||"",this._totalBytes=+request,
this._lengthComputable=!!request,this._setReadyState(XMLHttpRequest.HEADERS_RECEIVED)))};XMLHttpRequest.prototype._onHttpResponseData=function(response,data){this._response===response&&(this._responseParts.push(new Buffer(data)),this._loadedBytes+=data.length,this.readyState!==XMLHttpRequest.LOADING&&this._setReadyState(XMLHttpRequest.LOADING),this._dispatchProgress("progress"))};XMLHttpRequest.prototype._onHttpResponseEnd=function(response){this._response===response&&(this._parseResponse(),this._response=
this._request=null,this._setReadyState(XMLHttpRequest.DONE),this._dispatchProgress("load"),this._dispatchProgress("loadend"))};XMLHttpRequest.prototype._onHttpResponseClose=function(response){this._response===response&&(response=this._request,this._setError(),response.abort(),this._setReadyState(XMLHttpRequest.DONE),this._dispatchProgress("error"),this._dispatchProgress("loadend"))};XMLHttpRequest.prototype._onHttpTimeout=function(request){this._request===request&&(this._setError(),request.abort(),
this._setReadyState(XMLHttpRequest.DONE),this._dispatchProgress("timeout"),this._dispatchProgress("loadend"))};XMLHttpRequest.prototype._onHttpRequestError=function(request,error){this._request===request&&(this._setError(),request.abort(),this._setReadyState(XMLHttpRequest.DONE),this._dispatchProgress("error"),this._dispatchProgress("loadend"))};XMLHttpRequest.prototype._dispatchProgress=function(eventType){eventType=new XMLHttpRequest.ProgressEvent(eventType);eventType.lengthComputable=this._lengthComputable;
eventType.loaded=this._loadedBytes;eventType.total=this._totalBytes;this.dispatchEvent(eventType)};XMLHttpRequest.prototype._setError=function(){this._responseParts=this._responseHeaders=this._response=this._request=null};XMLHttpRequest.prototype._parseUrl=function(urlString,user,password){urlString=null==this.nodejsBaseUrl?urlString:url$jscomp$0.resolve(this.nodejsBaseUrl,urlString);urlString=url$jscomp$0.parse(urlString,!1,!0);urlString.hash=null;var _a=(urlString.auth||"").split(":"),xhrUser=_a[0];
_a=_a[1];if(xhrUser||_a||user||password)urlString.auth=(user||xhrUser||"")+":"+(password||_a||"");return urlString};XMLHttpRequest.prototype._parseResponseHeaders=function(response){this._responseHeaders={};for(var name_1 in response.headers){var loweredName=name_1.toLowerCase();this._privateHeaders[loweredName]||(this._responseHeaders[loweredName]=response.headers[name_1])}null!=this._mimeOverride&&(this._responseHeaders["content-type"]=this._mimeOverride)};XMLHttpRequest.prototype._parseResponse=
function(){var buffer=Buffer.concat(this._responseParts);this._responseParts=null;switch(this.responseType){case "json":this.responseText=null;try{this.response=JSON.parse(buffer.toString("utf-8"))}catch(_a){this.response=null}break;case "buffer":this.responseText=null;this.response=buffer;break;case "arraybuffer":this.responseText=null;for(var arrayBuffer=new ArrayBuffer(buffer.length),view=new Uint8Array(arrayBuffer),i=0;i<buffer.length;i++)view[i]=buffer[i];this.response=arrayBuffer;break;default:try{this.responseText=
buffer.toString(this._parseResponseEncoding())}catch(_b){this.responseText=buffer.toString("binary")}this.response=this.responseText}};XMLHttpRequest.prototype._parseResponseEncoding=function(){return/;\s*charset=(.*)$/.exec(this._responseHeaders["content-type"]||"")[1]||"utf-8"};XMLHttpRequest.ProgressEvent=progress_event_1.ProgressEvent;XMLHttpRequest.InvalidStateError=errors_1.InvalidStateError;XMLHttpRequest.NetworkError=errors_1.NetworkError;XMLHttpRequest.SecurityError=errors_1.SecurityError;
XMLHttpRequest.SyntaxError=errors_1.SyntaxError;XMLHttpRequest.XMLHttpRequestUpload=xml_http_request_upload_1.XMLHttpRequestUpload;XMLHttpRequest.UNSENT=0;XMLHttpRequest.OPENED=1;XMLHttpRequest.HEADERS_RECEIVED=2;XMLHttpRequest.LOADING=3;XMLHttpRequest.DONE=4;XMLHttpRequest.cookieJar=Cookie.CookieJar();return XMLHttpRequest}(global.XMLHttpRequestEventTarget);exports.XMLHttpRequest=require;require.prototype.nodejsHttpAgent=http.globalAgent;require.prototype.nodejsHttpsAgent=https.globalAgent;require.prototype.nodejsBaseUrl=
null}
//# sourceMappingURL=module$node_modules$xhr2_cookies$dist$xml_http_request.js.map
